 clear all;
 %%%%%%%%%%%%%%%%%%%%%%
 %基本晶格产生参数
 %a,b 石墨烯原胞边长：c:
 a=3.55871;
 b=3.55871;
 %b=6.1638665294;
 c=(1/3)*(pi);
 %%%%%%%%%%%%%%%%%%%%%%
 n=10;
 i=1;
 for x1=1:n
     for y1=-n:n
  
         for x2=-n:n
           for y2=-n:n
                 if (abs((x1*x2*(a^2) +(x1*y2+x2*y1)*(a*b)*(cos(c))+y1*y2*(b^2))/(((((x1*a)^2)+((y1*b)^2)+(2*x1*y1*a*b*cos(c)))^(1/2))+((((x2*a)^2)+((y2*b)^2)+(2*x2*y2*a*b*cos(c)))^(1/2))))<0.0001)
                 A(i,1)=x1;
                 A(i,2)=y1;
                 A(i,3)=x2;
                 A(i,4)=y2;
                 A(i,5)=((((x1*a)^2)+((y1*b)^2)+(2*x1*y1*a*b*cos(c)))^(1/2));
                 A(i,6)=((((x2*a)^2)+((y2*b)^2)+(2*x2*y2*a*b*cos(c)))^(1/2));
                 i=i+1;
             end
                 
           end
         end
             
     end
 end
 %clear a;
 %clear b;
 %clear c;
 clear x1;
 clear y1;
 clear x2;
 clear y2;
 clear n;
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
%将边长大于max的组合筛选出去
n = size(A,1);
aa=1;
 max=20;
for i=1:n
    if (A(i,5)<=max)&&(A(i,5)>0)&&(A(i,6)<=max)&&(A(i,6)>0)           
                 B(aa,1)=A(i,1);
                 B(aa,2)=A(i,2);
                 B(aa,3)=A(i,3);
                 B(aa,4)=A(i,4); 
                 B(aa,5)=A(i,5);
                 B(aa,6)=A(i,6); 
                 B(aa,7)=rad2deg(acos((((A(i,1)+A(i,3))*(a^2))+((A(i,2)+A(i,4))*(a*b)*cos(c)))/((((((A(i,1)+A(i,3))^2)*(a^2))+(((A(i,2)+A(i,4))^2)*(b^2))+2*(A(i,1)+A(i,3))*(A(i,2)+A(i,4))*(a*b*cos(c)))^(1/2))*a)));
                 aa=aa+1;
    end
end
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%匹配合适的角度
 n = size(B,1);
 k=1;
 for i=1:n-1
     x1=B(i,5);
     kx1=B(i,1);
     ky1=B(i,2);
     y1=B(i,6);
     for j=(i+1):n
         x2=B(j,5);
         kx2=B(j,1);
         ky2=B(j,2);
         y2=B(j,6);
         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
         a=ceil(max/x1);
         b=ceil(max/y1);
         c=ceil(max/x2);
         d=ceil(max/y2);
         
         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
         %(x1,x2),(y1,y2)
          for a1=1:a
             for b1=1:b
                 for c1=1:c
                     for d1=1:d
                         if ((abs(1-((x1*a1)/((x1*a1+x2*c1)/2)))<=0.05)&&(abs(1-((x1*a1)/((x1*a1+x2*c1)/2)))>0.000001)&&(abs(1-((x2*c1)/((x1*a1+x2*c1)/2)))<=0.05)&&(abs(1-((x2*c1)/((x1*a1+x2*c1)/2)))>0.000001)&&(abs(1-((y1*b1)/((y1*b1+y2*d1)/2)))<=0.05)&&(abs(1-((y1*b1)/((y1*b1+y2*d1)/2)))>0.000001)&&(abs(1-((y2*d1)/((y1*b1+y2*d1)/2)))<=0.05)&&(abs(1-((y2*d1)/((y1*b1+y2*d1)/2)))>0.000001))
                              
                             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                             %(x1,y1)信息记录
                              C(k,1)=B(i,1);
                              C(k,2)=B(i,2);
                              C(k,3)=B(i,3);
                              C(k,4)=B(i,4);
                              C(k,5)=x1;
                              C(k,6)=y1;
                              C(k,7)=a1;
                              C(k,8)=b1;
                              C(k,9)=0;
                             %(x2,y2)信息记录
                              C(k,10)=B(j,1);
                              C(k,11)=B(j,2);
                              C(k,12)=B(j,3);
                              C(k,13)=B(j,4);
                              C(k,14)=x2;
                              C(k,15)=y2;
                              C(k,16)=c1;
                              C(k,17)=d1;
                              C(k,18)=B(i,7)-B(j,7);
                              C(k,19)=((x1*a1+x2*c1)/2)*((y1*b1+y2*d1)/2);
                             k=k+1;
                             
                         end
                     end
                 end
             end
          end
         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
         %(x1,y2),(y1,x2)
          for a1=1:a
             for b1=1:b
                 for c1=1:c
                     for d1=1:d
                         if ((abs(1-((x1*a1)/((x1*a1+y2*d1)/2)))<=0.05)&&(abs(1-((x1*a1)/((x1*a1+y2*d1)/2)))>0.000001)&&(abs(1-((y2*d1)/((x1*a1+y2*d1)/2)))<=0.05)&&(abs(1-((y2*d1)/((x1*a1+y2*d1)/2)))>0.000001)&&(abs(1-((y1*b1)/((y1*b1+x2*c1)/2)))<=0.05)&&(abs(1-((y1*b1)/((y1*b1+x2*c1)/2)))>0.000001)&&(abs(1-((x2*c1)/((y1*b1+x2*c1)/2)))<=0.05)&&(abs(1-((x2*c1)/((y1*b1+x2*c1)/2)))>0.000001))
                              
                             %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
                             %(x1,y1)信息记录
                              C(k,1)=B(i,1);
                              C(k,2)=B(i,2);
                              C(k,3)=B(i,3);
                              C(k,4)=B(i,4);
                              C(k,5)=x1;
                              C(k,6)=y1;
                              C(k,7)=a1;
                              C(k,8)=b1;
                              C(k,9)=0;
                             %(x2,y2)信息记录
                              C(k,10)=B(j,1);
                              C(k,11)=B(j,2);
                              C(k,12)=B(j,3);
                              C(k,13)=B(j,4);
                              C(k,14)=x2;
                              C(k,15)=y2;
                              C(k,16)=c1;
                              C(k,17)=d1;
                              C(k,18)=B(i,7)-B(j,7);
                              C(k,19)=((x1*a1+y2*d1)/2)*((y1*b1+x2*c1)/2);
                              k=k+1;
                         end
                     end
                 end
             end
          end
         %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
     end
 end
 
D=sortrows(C,19); 
str1 = strcat ('PipeiData.txt');              
dlmwrite(str1, D, 'delimiter', '\t','precision', 6,'newline', 'pc')
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 